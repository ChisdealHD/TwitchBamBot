<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>thatsBamBot</title>
    <style type="text/css">
    @import url(https://fonts.googleapis.com/css?family=Open+Sans);
    body {
        background: #1a1a1a;
        color: #FFF;
        font-family: 'Open Sans', sans-serif;
        font-size: 1.25em;
        padding: 20px;
    }

    ul {
        list-style: none;
    }

    [data-specialColor="rainbow"]{
        display: inline-block;
        background-image: -webkit-gradient( linear, left top, right top, color-stop(0, #f22), color-stop(0.15, #f2f), color-stop(0.3, #22f), color-stop(0.45, #2ff), color-stop(0.6, #2f2), color-stop(0.75, #2f2), color-stop(0.9, #ff2), color-stop(1, #f22));
        background-image: gradient( linear, left top, right top, color-stop(0, #f22), color-stop(0.15, #f2f), color-stop(0.3, #22f), color-stop(0.45, #2ff), color-stop(0.6, #2f2), color-stop(0.75, #2f2), color-stop(0.9, #ff2), color-stop(1, #f22));
        color: transparent !important;
        -webkit-background-clip: text;
        background-clip: text;
    }
    </style>
</head>

<body>
    <script src="//code.jquery.com/jquery-1.12.0.min.js"></script>
    <script src="js/socket.io.js"></script>
    HEY I'M THE BOT
    <br> set your colour in chat:
    <br> colour [colour name]
    <ul class="user-list"></ul>
    <script>
    var options = {
        disconnected: false
    };

    var socket = io();

    socket.on('usersWithColours', function(data) {
        var userList = $(".user-list");

        userList.html("");

        data.forEach(function(userObj) {
            var username = userObj.key,
                userColor = userObj.value,
                listItem = $("<li/>").html(username).addClass(username);

                listItem.attr("data-specialColor", userColor);

            listItem.css({
                color: userColor
            });
            userList.append(listItem);
        })
    });

    socket.on('sfx', function(file) {
        var audio = document.createElement("AUDIO");
        audio.src = file;
        audio.autoplay = true;
        document.body.appendChild(audio);
        audio.addEventListener("ended", function() {
            document.body.removeChild(audio);
        }, true);

        audio.addEventListener("error", function() {
            document.body.removeChild(audio);
        }, true);
    });

    //disconnect/reconnect
    socket.on('connection', function() {
        options.disconnected = false;
        console.log("CONNECTED");
    });

    socket.on('reconnect', function() {
        options.disconnected = false;
        console.log("RECONNECTED");
    });

    socket.on('disconnect', function() {
        options.disconnected = true;
        console.log("DISCONNECT");
        startRefresh();
    });

    function startRefresh() {
        socket.io.reconnect();
        console.log("RECONNECT ATTEMPT");
        setTimeout(function() {
            if (options.disconnected === true) startRefresh();
        }, 1000);
    }
    </script>
</body>

</html>
